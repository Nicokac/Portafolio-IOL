# QA posterior a la transición v0.5.0-dev

## Resumen ejecutivo
- Perfil inversor persistente rehidratado desde `config.json`/`st.secrets` sin conectividad, manteniendo cifrado simétrico (`ProfileService`).
- Servicios `backtesting_service` y `cache_service` consumen fixtures locales y reutilizan caché en modo desconectado.
- `_render_for_test()` arma perfil activo + benchmark, tabla de recomendaciones y curva de equity desde fixtures.
- Tiempo de carga cacheada de precios < 2 ms (0.012 ms) validado sobre `BacktestingService.load_prices()`.
- Versión `0.5.0-dev` sincronizada en pyproject, módulo `shared.version` y documentación.

## Evidencia detallada

### Persistencia de perfil offline
- `ProfileService` normaliza perfil, rehidrata desde sesión, secretos cifrados o `config.json`, con Fernet y clave derivada. 【F:application/profile_service.py†L18-L156】【F:application/profile_service.py†L182-L236】
- Test `test_profile_service_persists_profile_with_encryption` cubre rehidratación offline con cifrado simétrico. 【F:tests/application/test_profile_service.py†L1-L40】

### Backtesting y caché offline
- `BacktestingService` carga `prices_<symbol>.csv` desde `docs/fixtures/default`, ejecuta `run_backtest` y cachea resultados vía `CacheService`. 【F:application/backtesting_service.py†L1-L113】
- Test `test_backtesting_service_uses_cache` demuestra reutilización sin token IOL. 【F:tests/application/test_backtesting_service.py†L19-L37】
- Medición de caché: `cached load ms=0.012` tras primer acceso (12.217 ms). 【0d92f8†L1-L1】

### CacheService en modo desconectado
- Caché TTL thread-safe sin dependencias externas, apta para fixtures offline. 【F:services/cache.py†L40-L122】
- Tests garantizan expiración TTL y `get_or_set` deterministas en desconectado. 【F:tests/application/test_backtesting_service.py†L39-L61】

### Benchmark y recomendaciones
- `compute_benchmark_comparison` entrega métricas relativas con dataset local. 【F:tests/application/test_benchmark_service.py†L1-L35】
- `_render_for_test()` inyecta fixtures (`profile_default.json`, `recommendations_sample.csv`) y despliega perfil + benchmark, tabla y equity curve. 【F:ui/tabs/recommendations.py†L628-L899】【F:docs/fixtures/default/recommendations_sample.csv†L1-L5】
- Ejecución manual imprime warnings benignos por modo headless, sin errores críticos. 【900815†L1-L20】

### Render cacheado y fixtures
- Recomendaciones y perfil se alimentan de fixtures sin API externa. 【F:ui/tabs/recommendations.py†L853-L899】【F:docs/fixtures/default/profile_default.json†L1-L9】
- `BacktestingService` usa `load_prices_from_fixture` para equity curve. 【F:application/backtesting_service.py†L26-L72】

### Versión y documentación
- Versionado consistente en código y docs (`0.5.0-dev`). 【F:pyproject.toml†L1-L30】【F:shared/version.py†L1-L24】【F:README.md†L12-L26】【F:CHANGELOG.md†L1-L20】

### Suite ejecutada
- `pytest tests/application/test_profile_service.py -q` ✅ (2 tests). 【ee290e†L1-L61】
- `pytest tests/application/test_benchmark_service.py -q` ✅ (2 tests). 【53c13c†L1-L55】
- `pytest tests/application/test_backtesting_service.py -q` ✅ (3 tests, 1 warning por deprecación legacy). 【20ae33†L1-L57】
- `python ui.tabs.recommendations._render_for_test` con fixtures ✅ (solo warnings de Streamlit bare mode). 【900815†L1-L20】

